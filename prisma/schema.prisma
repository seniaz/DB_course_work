generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model author {
  authorid   Int          @id @default(autoincrement())
  firstname  String       @db.VarChar(50)
  middlename String?      @db.VarChar(50)
  lastname   String       @db.VarChar(50)
  country    String?      @db.VarChar(50)
  birthdate  DateTime?    @db.Date
  deathdate  DateTime?    @db.Date
  photourl   String?
  biography  String?
  bookauthor bookauthor[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model book {
  bookid          Int          @id @default(autoincrement())
  title           String       @db.VarChar(255)
  isbn            String?      @unique @db.VarChar(17)
  publicationdate DateTime?    @db.Date
  description     String?
  pagecount       Int?
  language        String       @default("English") @db.VarChar(50)
  coverurl        String?
  publisherid     Int?
  publisher       publisher?   @relation(fields: [publisherid], references: [publisherid], onUpdate: NoAction)
  bookauthor      bookauthor[]
  bookgenre       bookgenre[]
  rating          rating[]
  review          review[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bookauthor {
  bookid      Int
  authorid    Int
  authororder Int
  author      author @relation(fields: [authorid], references: [authorid], onDelete: Cascade, onUpdate: NoAction)
  book        book   @relation(fields: [bookid], references: [bookid], onDelete: Cascade, onUpdate: NoAction)

  @@id([bookid, authorid])
}

model bookgenre {
  bookid  Int
  genreid Int
  book    book  @relation(fields: [bookid], references: [bookid], onDelete: Cascade, onUpdate: NoAction)
  genre   genre @relation(fields: [genreid], references: [genreid], onDelete: Cascade, onUpdate: NoAction)

  @@id([bookid, genreid])
}

model genre {
  genreid     Int         @id @default(autoincrement())
  name        String      @unique @db.VarChar(50)
  description String?
  bookgenre   bookgenre[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model publisher {
  publisherid Int     @id @default(autoincrement())
  name        String  @db.VarChar(100)
  country     String? @db.VarChar(50)
  website     String?
  foundedyear Int?
  book        book[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model rating {
  ratingid Int     @id @default(autoincrement())
  userid   Int
  bookid   Int
  score    Decimal @db.Decimal(2, 1)
  book     book    @relation(fields: [bookid], references: [bookid], onDelete: Cascade, onUpdate: NoAction)
  users    users   @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userid, bookid])
}

model readinglist {
  readinglistid Int      @id @default(autoincrement())
  userid        Int
  bookid        Int
  status        String   @db.VarChar(20)
  addeddate     DateTime @default(now()) @db.Timestamp(6)

  @@unique([userid, bookid])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model review {
  reviewid     Int       @id @default(autoincrement())
  userid       Int
  bookid       Int
  reviewtext   String
  reviewdate   DateTime  @default(now()) @db.Timestamp(6)
  lasteditdate DateTime? @db.Timestamp(6)
  book         book      @relation(fields: [bookid], references: [bookid], onDelete: Cascade, onUpdate: NoAction)
  users        users     @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userid, bookid])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  userid    Int      @id @default(autoincrement())
  username  String   @unique @db.VarChar(50)
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  nickname  String?  @db.VarChar(50)
  avatarurl String?
  rating    rating[]
  review    review[]
}
