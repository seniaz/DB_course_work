<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Rating System - –ö—É—Ä—Å–æ–≤–∞ —Ä–æ–±–æ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .tasks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .task-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .task-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .task-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            color: #555;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            margin-top: 20px;
        }

        .result h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .result pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
        }

        .analytics {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .analytics h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .analytics-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .success {
            color: #28a745;
            font-weight: 600;
        }

        .error {
            color: #dc3545;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1>üìö Book Rating System</h1>
            <p>–ö—É—Ä—Å–æ–≤–∞ —Ä–æ–±–æ—Ç–∞ –∑ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö"</p>
            <p style="margin-top: 10px; color: #667eea; font-weight: 600;">
                API –ø—Ä–∞—Ü—é—î?: <span id="apiStatus">–ø–µ—Ä–µ–≤—ñ—Ä—è—é...</span>
            </p>
        </div>

        <!-- –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ö–æ–º–ø–ª–µ–∫—Å–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è -->
        <div class="tasks">
            <div class="task-card">
                <h2>üìù –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ö–æ–º–ø–ª–µ–∫—Å–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</h2>
                <p>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–π—Ç–∏–Ω–≥—É —Ç–∞ –≤—ñ–¥–≥—É–∫—É –≤ –æ–¥–Ω—ñ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</p>
                
                <div class="input-group">
                    <label>ID –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
                    <input type="number" id="task1_userId" value="1" min="1">
                </div>
                
                <div class="input-group">
                    <label>ID –ö–Ω–∏–≥–∏:</label>
                    <input type="number" id="task1_bookId" value="1" min="1">
                </div>
                
                <div class="input-group">
                    <label>–û—Ü—ñ–Ω–∫–∞ (1.0 - 5.0):</label>
                    <input type="number" id="task1_score" value="4.5" min="1" max="5" step="0.1">
                </div>
                
                <div class="input-group">
                    <label>–¢–µ–∫—Å—Ç –≤—ñ–¥–≥—É–∫—É:</label>
                    <textarea id="task1_review">–ß—É–¥–æ–≤–∞ –∫–Ω–∏–≥–∞! –î—É–∂–µ —Å–ø–æ–¥–æ–±–∞–ª–∞—Å—å.</textarea>
                </div>
                
                <button class="btn" onclick="task1Create()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥ + –≤—ñ–¥–≥—É–∫</button>
            </div>

            <!-- –ó–∞–≤–¥–∞–Ω–Ω—è 2: –û–Ω–æ–≤–ª–µ–Ω–Ω—è -->
            <div class="task-card">
                <h2>üîÑ –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ë–µ–∑–ø–µ—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>
                <p>–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–π—Ç–∏–Ω–≥—É –∑ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º</p>
                
                <div class="input-group">
                    <label>ID –†–µ–π—Ç–∏–Ω–≥—É:</label>
                    <input type="number" id="task2_ratingId" value="1" min="1">
                </div>
                
                <div class="input-group">
                    <label>–ù–æ–≤–∞ –æ—Ü—ñ–Ω–∫–∞:</label>
                    <input type="number" id="task2_score" value="5.0" min="1" max="5" step="0.1">
                </div>
                
                <button class="btn" onclick="task2Update()">–û–Ω–æ–≤–∏—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥</button>
                <p style="margin-top: 10px; font-size: 12px; color: #999;">
                    *–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º–∞—î –ø–æ—Ç–æ—á–Ω–∏–π timestamp
                </p>
            </div>

            <!-- –ó–∞–≤–¥–∞–Ω–Ω—è 3: –í–∏–¥–∞–ª–µ–Ω–Ω—è -->
            <div class="task-card">
                <h2>üóëÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ú'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h2>
                <p>–ö–∞—Å–∫–∞–¥–Ω–µ –º'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –π–æ–≥–æ –¥–∞–Ω–∏—Ö</p>
                
                <div class="input-group">
                    <label>ID –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
                    <input type="number" id="task3_userId" value="3" min="1">
                </div>
                
                <button class="btn" onclick="task3Delete()">–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
                <p style="margin-top: 10px; font-size: 12px; color: #999;">
                    *–ú'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (–º–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏)
                </p>
            </div>

            <!-- –ó–∞–≤–¥–∞–Ω–Ω—è 4: –ü—Ä–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç–∏ -->
            <div class="task-card">
                <h2>üîç –ó–∞–≤–¥–∞–Ω–Ω—è 4: –ü—Ä–æ—Å—Ç—ñ SELECT</h2>
                <p>–û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –±–∞–∑–∏</p>
                
                <button class="btn" onclick="task4GetRatings()" style="margin-bottom: 10px;">
                    –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —Ä–µ–π—Ç–∏–Ω–≥–∏
                </button>
                
                <div class="input-group">
                    <label>ID –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
                    <input type="number" id="task4_userId" value="1" min="1">
                </div>
                
                <button class="btn" onclick="task4GetUser()">
                    –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                </button>
            </div>
        </div>

        <!-- –ó–∞–≤–¥–∞–Ω–Ω—è 5: –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ -->
        <div class="analytics">
            <h2>üìä –ó–∞–≤–¥–∞–Ω–Ω—è 5: –°–∫–ª–∞–¥–Ω—ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∑–∞–ø–∏—Ç–∏</h2>
            <div class="analytics-buttons">
                <button class="btn" onclick="task5UserActivity()">
                    –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
                </button>
                <button class="btn" onclick="task5BooksStats()">
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–Ω–∏–≥–∞—Ö
                </button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
        <div class="result" id="result" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
            <pre id="resultContent"></pre>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API
        async function checkAPI() {
            try {
                const res = await fetch(`${API_URL}/health`);
                const data = await res.json();
                document.getElementById('apiStatus').textContent = '‚úÖ –ü—Ä–∞—Ü—é—î';
                document.getElementById('apiStatus').style.color = '#28a745';
            } catch (err) {
                document.getElementById('apiStatus').textContent = '‚ùå –ù–µ –ø—Ä–∞—Ü—é—î';
                document.getElementById('apiStatus').style.color = '#dc3545';
            }
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        function showResult(data, success = true) {
            const result = document.getElementById('result');
            const content = document.getElementById('resultContent');
            
            result.style.display = 'block';
            content.textContent = JSON.stringify(data, null, 2);
            content.style.color = success ? '#28a745' : '#dc3545';
            
            result.scrollIntoView({ behavior: 'smooth' });
        }

        // –ó–∞–≤–¥–∞–Ω–Ω—è 1
        async function task1Create() {
            const userId = document.getElementById('task1_userId').value;
            const bookId = document.getElementById('task1_bookId').value;
            const score = document.getElementById('task1_score').value;
            const reviewText = document.getElementById('task1_review').value;

            try {
                const res = await fetch(`${API_URL}/api/reviews/full`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        userId: parseInt(userId), 
                        bookId: parseInt(bookId), 
                        score: parseFloat(score), 
                        reviewText 
                    })
                });

                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        // –ó–∞–≤–¥–∞–Ω–Ω—è 2
        async function task2Update() {
            const ratingId = document.getElementById('task2_ratingId').value;
            const score = document.getElementById('task2_score').value;

            try {
                // –°–ø–æ—á–∞—Ç–∫—É –æ—Ç—Ä–∏–º—É—é –ø–æ—Ç–æ—á–Ω–∏–π timestamp
                const getRating = await fetch(`${API_URL}/api/ratings?minScore=0`);
                const ratings = await getRating.json();
                const currentRating = ratings.data.find(r => r.ratingId === parseInt(ratingId));
                
                if (!currentRating) {
                    showResult({ error: '–†–µ–π—Ç–∏–Ω–≥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ' }, false);
                    return;
                }

                const res = await fetch(`${API_URL}/api/ratings/${ratingId}/safe`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        score: parseFloat(score),
                        lastUpdatedAt: currentRating.updatedAt
                    })
                });

                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        // –ó–∞–≤–¥–∞–Ω–Ω—è 3
        async function task3Delete() {
            const userId = document.getElementById('task3_userId').value;

            try {
                const res = await fetch(`${API_URL}/api/users/${userId}/deactivate`, {
                    method: 'DELETE'
                });

                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        // –ó–∞–≤–¥–∞–Ω–Ω—è 4
        async function task4GetRatings() {
            try {
                const res = await fetch(`${API_URL}/api/ratings?minScore=0`);
                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        async function task4GetUser() {
            const userId = document.getElementById('task4_userId').value;

            try {
                const res = await fetch(`${API_URL}/api/users/${userId}`);
                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        // –ó–∞–≤–¥–∞–Ω–Ω—è 5
        async function task5UserActivity() {
            try {
                const res = await fetch(`${API_URL}/api/analytics/user-activity`);
                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        async function task5BooksStats() {
            try {
                const res = await fetch(`${API_URL}/api/analytics/books-stats`);
                const data = await res.json();
                showResult(data, res.ok);
            } catch (err) {
                showResult({ error: err.message }, false);
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        checkAPI();
        setInterval(checkAPI, 30000); // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
    </script>
</body>
</html>